<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Alma - Demo</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 2rem; background:#f5f5f5; }
    #chat { max-width: 600px; margin: auto; }
    video { width: 320px; height: auto; margin-top: 20px; border-radius: 8px; background: black; }
    input { padding: 8px; width: 70%; }
    button { padding: 8px 12px; margin-left: 5px; }
    .msg { text-align: left; background: #fff; padding: 10px; margin: 5px 0; border-radius: 5px; }
    .user { background: #d1ecf1; }
    .alma { background: #e2e3e5; }
  </style>
</head>
<body>
  <h1>Alma</h1>
  <div id="chat"></div>
  <input id="question" type="text" placeholder="Escreve a tua pergunta...">
  <button onclick="sendQuestion()">Enviar</button>

  <video id="video" autoplay playsinline controls></video>

<script>
const API_SERVER = "https://alma-server-alma-1.up.railway.app";   // backend (texto)
const API_BODY   = "https://almabody-alma-1.up.railway.app";      // D-ID (vídeo)

// Função: mostrar mensagens no chat
function addMessage(text, sender) {
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "msg " + sender;
  div.innerText = text;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// Enviar pergunta → obter resposta de texto → gerar vídeo
async function sendQuestion() {
  const q = document.getElementById("question").value;
  if (!q) return;
  addMessage(q, "user");
  document.getElementById("question").value = "";

  try {
    // 1) Pergunta ao alma-server
    let res = await fetch(API_SERVER + "/ask", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ question: q })
    });
    let data = await res.json();
    let answer = data.answer || "Não consegui responder.";
    addMessage(answer, "alma");

    // 2) Gera vídeo com D-ID via almabody
    let talkRes = await fetch(API_BODY + "/say", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ text: answer })
    });
    let talkData = await talkRes.json();
    console.log("talkData", talkData);

    if (talkData.video_url) {
      const video = document.getElementById("video");
      video.src = talkData.video_url;
      video.play();
    } else {
      console.error("Erro no almabody:", talkData);
    }

  } catch (e) {
    console.error("Erro geral:", e);
  }
}
</script>
</body>
</html>
